<!DOCTYPE html>

<!--
  tree 树形菜单点击时打开并选中tab页 未添加右键关闭事件
-->
<html>
<head>
  <meta charset="utf-8">
  <title>layui tree菜单打开tab页示例</title>
  <link rel="stylesheet" href="/layui/css/layui.css"/>
</head>
<body>

<div class="layui-side layui-bg-black">
  <div class="layui-side-scroll">
    <ul id="treeDemo" class="layui-tree" lay-filter="treeDemo"></ul>
  </div>
</div>

<div class="layui-body" style="padding: 15px;">
  <div class="layui-tab" lay-filter="tabDemo" lay-allowClose="true">
    <ul class="layui-tab-title">
      <li class="layui-this">首页</li>
    </ul>
    <div class="layui-tab-content">
      <div class="layui-tab-item layui-show">首页内容</div>
    </div>
  </div>
</div>

<script src="/layui/layui.js"></script>
<script src="/js/jquery.js"></script>
<script>
  layui.use(['tree', 'element','jquery'], function(){
    var tree = layui.tree;
    var element = layui.element;
    var $ = layui.jquery;
    var tabIds={};

    // 渲染树形菜单
    tree.render({
      elem: '#treeDemo',
      data: [
        {
          title: '菜单1',
          id: 1,
          children: [
            {
              title: '子菜单1-1',
              id: 11,
              url: 'page1.html'
            },
            {
              title: '子菜单1-2',
              id: 12,
              url: 'page2.html'
            }
          ]
        },
        {
          title: '菜单2',
          id: 2,
          children: [
            {
              title: '子菜单2-1',
              id: 21,
              url: 'page3.html'
            }
          ]
        }
      ],
      click: function(obj){
        var nodeData = obj.data; // 获得当前点击的节点数据
        var title = nodeData.title;
        var layId = nodeData.id;

        // 判断tab是否已经打开
        if (tabIds[layId]) {
          element.tabChange('tabDemo', layId); // 如果已经打开，则切换
        } else {
          // 添加新的 tab
          element.tabAdd('tabDemo', {
            title: title,
            content: '内容 ' + layId,
            id: layId // 这里使用 layId 作为 tab 的内部 id
          });
          tabIds[layId] = true; // 将 layId 存储在全局对象中
          element.tabChange('tabDemo', layId); // 切换到新添加的 tab
        }



      }
    });


  });
</script>

</body>
</html>
